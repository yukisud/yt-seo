# YouTube文字起こし拡張機能

YouTube動画の字幕を取得して表示するChrome拡張機能です。

## 主な機能

- 📝 YouTube動画の字幕を自動取得
- ⏱️ タイムスタンプ付きで表示
- 🖱️ タイムスタンプクリックで動画の該当位置へジャンプ
- 📋 全文コピー機能
- 🌓 ダークモード対応
- 🇯🇵 日本語優先（他の言語にも対応）

## インストール方法

### 1. アイコンの準備（オプション）

SVGアイコンをPNGに変換する必要があります：

```bash
# ImageMagickを使用する場合
convert -background none -resize 16x16 icons/icon.svg icons/icon16.png
convert -background none -resize 48x48 icons/icon.svg icons/icon48.png
convert -background none -resize 128x128 icons/icon.svg icons/icon128.png
```

または、オンラインツール（例: https://cloudconvert.com/svg-to-png）を使用してSVGをPNGに変換してください。

**注意**: アイコンがなくても拡張機能は動作しますが、Chrome上でデフォルトアイコンが表示されます。

### 2. Chromeに拡張機能を読み込む

1. Chromeを開き、`chrome://extensions/` にアクセス
2. 右上の「デベロッパーモード」をONにする
3. 「パッケージ化されていない拡張機能を読み込む」をクリック
4. このプロジェクトのフォルダを選択

## 使い方

1. YouTubeで動画を開く
2. 動画の下に表示される「📝 文字起こし」ボタンをクリック
3. 右側にパネルが表示されるので「字幕を取得」ボタンをクリック
4. 字幕が表示されます

### 便利な機能

- **タイムスタンプクリック**: 各字幕のタイムスタンプをクリックすると、動画がその位置にジャンプします
- **コピー**: 「コピー」ボタンで全ての字幕をクリップボードにコピーできます
- **閉じる**: パネル右上の「×」ボタンでパネルを閉じることができます

## 技術仕様

- **Manifest Version**: 3
- **対応サイト**: YouTube (https://www.youtube.com/watch*)
- **必要な権限**:
  - `activeTab`: アクティブタブへのアクセス
  - `https://www.youtube.com/*`: YouTubeへのアクセス

## ファイル構成

```
yt-seo/
├── manifest.json       # 拡張機能の設定ファイル
├── content.js          # YouTubeページに挿入されるスクリプト
├── styles.css          # UIのスタイル
├── popup.html          # 拡張機能アイコンクリック時のポップアップ
├── icons/              # アイコンファイル
│   ├── icon.svg       # SVGアイコン（元ファイル）
│   ├── icon16.png     # 16x16 PNGアイコン（要作成）
│   ├── icon48.png     # 48x48 PNGアイコン（要作成）
│   └── icon128.png    # 128x128 PNGアイコン（要作成）
└── README.md          # このファイル
```

## 動作原理

この拡張機能は複数の方法で字幕を取得します（フォールバック機能付き）：

### 方法1: ytInitialPlayerResponse
1. YouTubeページの `ytInitialPlayerResponse` から字幕トラック情報を取得
2. 字幕トラックのURLから字幕データ（XML形式）を取得
3. XMLをパースして整形
4. タイムスタンプ付きでUIに表示

### 方法2: YouTube内部API
- `youtubei/v1/get_transcript` エンドポイントを使用
- プレイヤーレスポンスが取得できない場合のフォールバック

### 方法3: timedtext API（最も確実）
- YouTube の公開 timedtext API を直接使用
- **複数のフォーマット**を自動で試行：srv3（新XML）、json3（JSON）、デフォルト（旧XML）
- **自動生成字幕**にも対応（`kind=asr` パラメータ）
- **10言語**を自動で試行（ja, en, ko, zh-Hans, zh-Hant, es, fr, de, pt, ru）
- 最も確実な取得方法

これらの方法を順番に試すことで、様々な状況でも字幕を取得できるようになっています。

## 注意事項

- この拡張機能は、動画に字幕が設定されている場合のみ動作します
- 字幕がない動画では「この動画には字幕がありません」と表示されます
- YouTubeの仕様変更により、将来的に動作しなくなる可能性があります

## トラブルシューティング

### 字幕が取得できない場合

1. **デバッグ情報を確認**
   - F12キーを押してブラウザのコンソールを開く
   - コンソールに表示される `[字幕取得]` で始まるログを確認
   - どの方法（方法1/2/3）まで試行されたか確認

2. **動画に字幕があるか確認**
   - YouTubeの字幕ボタン（CC）をクリック
   - 字幕の設定で利用可能な字幕があるか確認
   - 自動生成字幕も対応しています

3. **基本的な対処法**
   - ページを再読み込み（F5）
   - 拡張機能を再読み込み（chrome://extensions/ でリロード）
   - ブラウザを再起動

4. **それでも動かない場合**
   - コンソールのエラーメッセージをコピー
   - GitHubのIssueで報告してください

### ボタンが表示されない場合

1. YouTubeの動画ページ（/watch?v=...）にいることを確認
2. ページを再読み込みしてみる
3. 2-3秒待つ（ボタンは遅延表示されます）
4. ブラウザのコンソール（F12）でエラーを確認

### デバッグモード

拡張機能には詳細なログ機能が組み込まれています：
- F12キーでコンソールを開く
- `[字幕取得]`, `[方法1]`, `[方法2]`, `[方法3]` などのログを確認
- どの段階で失敗しているか把握できます

## ライセンス

MIT License

## 開発者向け情報

### デバッグ方法

1. Chrome DevTools (F12) を開く
2. Console タブでエラーメッセージを確認
3. 拡張機能のバックグラウンドページは `chrome://extensions/` の「詳細」→「バックグラウンドページ」から確認可能

### カスタマイズ

- `styles.css`: UIの見た目を変更
- `content.js`: 機能の追加や変更
- `manifest.json`: 権限や設定の変更

## 今後の改善案

- [ ] 字幕のフィルタリング機能
- [ ] 複数言語の字幕を同時表示
- [ ] 字幕の検索機能
- [ ] エクスポート形式の選択（TXT, SRT, VTT等）
- [ ] 字幕の編集機能
